developer=https://github.com/shaarli
url=${developer}
maintainer=http://indiecomputing.com/
pkgname=$(basename $(pwd))
pkgver=0.8.0
pkgrel=1
pkgdesc="Your own URL shortener"
arch=('any')
license=("custom:zlib")
source=("shaarli-v${pkgver}.zip::https://github.com/shaarli/Shaarli/archive/v${pkgver}.zip")
options=('!strip')
sha512sums=('a0c4eb1e2a171d74b84258874b0af4ed6f12c0fbcb481736a223182fffe866cad50e9514bb8c847945da76a9dcc038b0b938dd734499715d6d323fa73734b9f5')

package() {
# Manifest
    mkdir -p ${pkgdir}/var/lib/ubos/manifests
    install -m0644 ${startdir}/ubos-manifest.json ${pkgdir}/var/lib/ubos/manifests/${pkgname}.json

# License
    mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
    install -m644 ${startdir}/COPYING ${pkgdir}/usr/share/licenses/${pkgname}/

# Icons
    mkdir -p ${pkgdir}/srv/http/_appicons/${pkgname}
    install -m644 ${startdir}/appicons/{72x72,144x144}.png ${pkgdir}/srv/http/_appicons/${pkgname}/

# Templates
    mkdir -p ${pkgdir}/usr/share/${pkgname}/tmpl
    install -m644 ${startdir}/tmpl/deny-htaccess      ${pkgdir}/usr/share/${pkgname}/tmpl/
    install -m644 ${startdir}/tmpl/datastore.php.tmpl ${pkgdir}/usr/share/${pkgname}/tmpl/

# Code
    mkdir -p ${pkgdir}/usr/share/${pkgname}/bin
    install -m755 ${startdir}/bin/generate-config.pl ${pkgdir}/usr/share/${pkgname}/bin/
    install -m755 ${startdir}/bin/fix-permissions.pl ${pkgdir}/usr/share/${pkgname}/bin/

    rsync --quiet --archive --exclude '.git*' ${startdir}/src/Shaarli-${pkgver}/* ${pkgdir}/usr/share/${pkgname}/web
}
